
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>git-sage | GitHub Analyzer</title>
  <!-- Bootstrap + Font Awesome (CDN links) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --main: #6f42c1;
      --accent: #6610f2;
    }

    body {
      background: linear-gradient(to right, #f5f7fa, #e4edf5);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 30px;
    }

    .title {
      text-align: center;
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--main);
    }

    .subtitle {
      text-align: center;
      font-size: 1.1rem;
      color: #6c757d;
      margin-bottom: 2rem;
    }

    .card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.07);
      margin-bottom: 2rem;
    }

    .ai-summary {
      background: rgba(111, 66, 193, 0.05);
      border-left: 5px solid var(--main);
      padding: 1rem;
      font-size: 1rem;
      white-space: pre-line;
    }

    .profile-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid #e4e4e4;
    }

    .stat-value {
      font-weight: bold;
      font-size: 1.3rem;
      color: var(--main);
    }

    .badge {
      border-radius: 8px;
      padding: 0.4rem 0.6rem;
      margin: 0.2rem;
      font-size: 0.85rem;
    }

    .icon-box {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-right: 1rem;
    }

    .icon-commit { background: #e0f5e9; color: #198754; }
    .icon-pr { background: #e0ecff; color: #0d6efd; }
    .icon-issue { background: #fff4d6; color: #ffc107; }

    .footer {
      text-align: center;
      font-size: 0.9rem;
      color: #777;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1 class="title">git‑sage</h1>
    <p class="subtitle">A simple GitHub activity summarizer with AI ✨</p>

    <!-- Form Card -->
    <div class="card p-4">
      <div class="row g-3 align-items-center">
        <div class="col-md-5">
          <input type="text" id="githubUsername" class="form-control" placeholder="Enter GitHub username">
        </div>
        <div class="col-md-4">
          <select id="timeRange" class="form-select">
            <option value="7">Last 7 days</option>
            <option value="14">Last 14 days</option>
            <option value="30">Last 30 days</option>
          </select>
        </div>
        <div class="col-md-3">
          <button id="analyzeBtn" class="btn btn-primary w-100">
            <i class="fas fa-robot me-2"></i> Analyze
          </button>
        </div>
      </div>
      <div id="errorAlert" class="alert alert-danger mt-3 d-none"></div>
    </div>

    <!-- Loader -->
    <div id="loader" class="text-center my-5 d-none">
      <div class="spinner-border text-primary"></div>
      <p class="mt-3">Analyzing GitHub activity using AI...</p>
    </div>

    <!-- Results Section -->
    <div id="results" class="d-none">
      <!-- Profile Info -->
      <div class="card p-4 d-flex flex-row align-items-center">
        <img id="avatar" src="https://via.placeholder.com/100" class="profile-img me-4">
        <div>
          <h4 id="userName"></h4>
          <p id="userBio" class="text-muted mb-2"></p>
          <div class="d-flex gap-4">
            <div><span class="stat-value" id="repoCount">0</span><br><small>Repos</small></div>
            <div><span class="stat-value" id="commitCount">0</span><br><small>Commits</small></div>
            <div><span class="stat-value" id="prCount">0</span><br><small>PRs</small></div>
            <div><span class="stat-value" id="issueCount">0</span><br><small>Issues</small></div>
          </div>
        </div>
      </div>

      <!-- AI Summary -->
      <div class="card p-4">
        <h5><i class="fas fa-lightbulb me-2 text-primary"></i>AI Summary</h5>
        <div class="ai-summary" id="aiSummary">Waiting for summary...</div>
        <div class="mt-3" id="tagsContainer"></div>
      </div>

      <!-- Contributions List -->
      <div class="card p-4">
        <h5><i class="fas fa-code-branch me-2 text-primary"></i>Recent Contributions</h5>
        <div id="contributionsList" class="mt-3"></div>
      </div>
    </div>

    <p class="footer">Made using Flask, GitHub API & OpenAI</p>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const loader = document.getElementById("loader");
    const results = document.getElementById("results");
    const errorAlert = document.getElementById("errorAlert");

    document.getElementById("analyzeBtn").addEventListener("click", async () => {
      const username = document.getElementById("githubUsername").value.trim();
      const days = document.getElementById("timeRange").value;

      if (!username) {
        errorAlert.textContent = "Please enter a GitHub username.";
        errorAlert.classList.remove("d-none");
        return;
      }

      errorAlert.classList.add("d-none");
      loader.classList.remove("d-none");
      results.classList.add("d-none");

      try {
        const res = await fetch("/analyze", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, days })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Something went wrong");

        fillProfile(data);
        fillSummary(data);
        fillContributions(data);

        loader.classList.add("d-none");
        results.classList.remove("d-none");
      } catch (err) {
        loader.classList.add("d-none");
        errorAlert.textContent = err.message;
        errorAlert.classList.remove("d-none");
      }
    });

    function fillProfile(data) {
      document.getElementById("avatar").src = data.avatar_url || "";
      document.getElementById("userName").textContent = data.name || "GitHub User";
      document.getElementById("userBio").textContent = data.bio || "No bio available.";
      document.getElementById("repoCount").textContent = data.public_repos;
      document.getElementById("commitCount").textContent = data.commit_count;
      document.getElementById("prCount").textContent = data.pr_count;
      document.getElementById("issueCount").textContent = data.issue_count;
    }

    function fillSummary(data) {
      document.getElementById("aiSummary").textContent = data.summary;
      const tagBox = document.getElementById("tagsContainer");
      tagBox.innerHTML = "";
      (data.tags || []).forEach(tag => {
        const badge = document.createElement("span");
        badge.className = "badge bg-secondary";
        badge.textContent = tag;
        tagBox.appendChild(badge);
      });
    }

    function fillContributions(data) {
      const container = document.getElementById("contributionsList");
      container.innerHTML = "";
      if (!data.contributions || data.contributions.length === 0) {
        container.innerHTML = "<p>No recent contributions found.</p>";
        return;
      }

      data.contributions.forEach(item => {
        const div = document.createElement("div");
        div.className = "d-flex align-items-center mb-3";

        const iconDiv = document.createElement("div");
        iconDiv.className = `icon-box icon-${item.type}`;
        iconDiv.innerHTML = `<i class="${getIcon(item.type)}"></i>`;

        const contentDiv = document.createElement("div");
        contentDiv.innerHTML = `<strong>${item.title}</strong><br><small class="text-muted">${item.repo}</small>`;

        div.appendChild(iconDiv);
        div.appendChild(contentDiv);
        container.appendChild(div);
      });
    }

    function getIcon(type) {
      const icons = {
        "commit": "fas fa-code-commit",
        "pr": "fas fa-code-pull-request",
        "issue": "fas fa-bug"
      };
      return icons[type] || "fas fa-code";
    }
  </script>
</body>
</html>
